<%- include('./partials/header') %>

<!-- Swiper CSS -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"
/>

<div
  class="w-full min-h-screen flex flex-col lg:flex-row items-start px-10 py-10 gap-10 bg-gray-50"
>
  <!-- Carousel Section -->
  <div class="lg:w-[40%] w-full p-4">
    <div class="swiper mySwiper h-[600px]">
      <div class="swiper-wrapper">
        <% user.cart.forEach((item) => { %>
        <div class="swiper-slide">
          <div
            class="rounded-md overflow-hidden border border-gray-200 shadow-sm"
          >
            <!-- Product Image -->
            <div
              class="w-full flex items-center justify-center h-80 bg-[<%= item.productId.bgColor %>]"
            >
              <img
                class="h-[18rem]"
                src="data:image/jpeg;base64,<%= item.productId.image.toString('base64') %>"
                alt="product image"
              />
            </div>

            <!-- Name + Quantity -->
            <div
              class="w-full flex justify-between items-center px-5 py-4 bg-[<%= item.productId.panelColor %>]"
            >
              <h3 class="text-2xl font-semibold text-white">
                <%= item.productId.name %>
              </h3>
              <div
                class="flex items-center gap-3 bg-white px-2 py-1 rounded-full"
              >
                <form
                  method="POST"
                  action="/cart/decrease/<%= item.productId._id %>"
                >
                  <button
                    class="ri-subtract-line text-black hover:text-red-500"
                  ></button>
                </form>
                <div class="px-3 font-bold text-black">
                  <%= item.quantity %>
                </div>
                <form
                  method="POST"
                  action="/cart/increase/<%= item.productId._id %>"
                >
                  <button
                    class="ri-add-line text-black hover:text-green-500"
                  ></button>
                </form>
              </div>
            </div>

            <!-- Subtotal + Remove -->
            <div
              class="flex flex-col gap-3 text-white px-5 py-4 bg-[<%= item.productId.textColor %>]"
            >
              <div class="w-full flex justify-between">
                <h4 class="text-lg">Subtotal</h4>
                <h2 class="text-lg font-semibold">
                  $ <%= ((item.productId.price - item.productId.discount) *
                  item.quantity).toFixed(2) %>
                </h2>
              </div>

              <form
                method="POST"
                action="/cart/remove/<%= item.productId._id %>"
                class="flex justify-center items-center"
              >
                <button
                  class="group bg-[<%= item.productId.textColor %>] text-white px-8 py-2 rounded-md text-sm transition-all transform duration-200 ease-in-out hover:bg-red-500 hover:scale-105 hover:shadow-lg"
                >
                  <span>Remove Product</span>
                  <span
                    class="opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                  >
                    üóëÔ∏è</span
                  >
                </button>
              </form>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
  </div>

  <!-- Price Breakdown Section -->
  <div class="lg:w-[60%] w-full sticky top-10">
    <h3 class="text-2xl font-bold mb-4">üßæ Price Breakdown</h3>
    <div class="px-6 py-6">
      <% user.cart.forEach((item) => { const discountedPrice =
      item.productId.price - item.productId.discount; const subtotal =
      discountedPrice * item.quantity; %>

      <div class="mb-6">
        <h4 class="text-xl font-semibold text-gray-800 mb-2">
          <%= item.productId.name %>
        </h4>

        <div class="flex justify-between mb-1">
          <span>Original Price</span>
          <span class="line-through text-gray-400"
            >$ <%= item.productId.price.toFixed(2) %></span
          >
        </div>

        <div class="flex justify-between mb-1">
          <span>Discount</span>
          <span class="text-green-600"
            >- $ <%= item.productId.discount.toFixed(2) %></span
          >
        </div>

        <div class="flex justify-between mb-1">
          <span>Price After Discount</span>
          <span>$ <%= discountedPrice.toFixed(2) %></span>
        </div>

        <div class="flex justify-between mb-1">
          <span>Service Fee</span>
          <span>$ 0.24</span>
        </div>

        <div class="flex justify-between mb-1">
          <span>Shipping</span>
          <span class="text-green-500 font-medium">FREE</span>
        </div>

        <hr class="my-4 border-t border-gray-300" />
      </div>
      <% }) %>

      <!-- Total Calculation -->
      <div
        class="flex justify-between items-center text-xl font-bold text-green-700"
      >
        <h3>Total</h3>
        <h3>
          $ <%= user.cart.reduce((total, item) => { const discountedPrice =
          item.productId.price - item.productId.discount; return total +
          (discountedPrice * item.quantity) + 0.24; }, 0).toFixed(2) %>
        </h3>
      </div>
    </div>
  </div>
</div>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
<script>
  const swiper = new Swiper(".mySwiper", {
    direction: "vertical",
    slidesPerView: 1,
    spaceBetween: 30,
    mousewheel: true,
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
  });
</script>

<%- include('./partials/footer') %>
