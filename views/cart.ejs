<%- include('./partials/header') %>

<div class="min-h-screen bg-gray-50 px-4 sm:px-6 py-8 sm:py-10">
  <h2 class="text-2xl sm:text-3xl font-bold mb-6">Shopping Cart</h2>

  <% if (user.cart.length === 0) { %>
  <div class="bg-white rounded-xl p-8 text-center">
    <p class="text-gray-500 text-lg">Your cart is empty üõí</p>
    <a
      href="/shop"
      class="inline-block mt-4 bg-black text-white px-6 py-2 rounded-lg"
    >
      Go Shopping
    </a>
  </div>
  <% } else { %>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- ================= CART ITEMS ================= -->
    <div class="lg:col-span-2 space-y-6">
      <% user.cart.forEach(item => { %>
      <div
        class="bg-white rounded-2xl shadow-sm p-4 sm:p-6 flex flex-wrap sm:flex-nowrap items-center gap-4"
      >
        <!-- Product Image -->
        <div class="w-24 h-24 sm:w-28 sm:h-28 flex-shrink-0">
          <img
            src="data:image/jpeg;base64,<%= item.productId.image.toString('base64') %>"
            alt="<%= item.productId.name %>"
            class="w-full h-full object-cover rounded-xl"
          />
        </div>

        <!-- Product Info -->
        <div class="flex-1 min-w-[140px]">
          <h3 class="text-lg font-semibold"><%= item.productId.name %></h3>
          <p class="text-gray-500">$<%= item.productId.price %></p>
        </div>

        <!-- Quantity -->
        <div class="flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-xl">
          <a
            href="/cart/decrease/<%= item.productId._id %>"
            class="w-10 h-10 flex items-center justify-center font-bold hover:bg-gray-200 rounded-lg"
            >‚àí</a
          >

          <span class="w-6 text-center font-semibold">
            <%= item.quantity %>
          </span>

          <a
            href="/cart/increase/<%= item.productId._id %>"
            class="w-10 h-10 flex items-center justify-center font-bold hover:bg-gray-200 rounded-lg"
            >+</a
          >
        </div>

        <!-- Delete -->
        <a
          href="/cart/remove/<%= item.productId._id %>"
          class="ml-auto w-10 h-10 flex items-center justify-center text-gray-400 hover:text-red-500"
        >
          üóëÔ∏è
        </a>
      </div>
      <% }) %>
    </div>

    <!-- ================= ORDER SUMMARY ================= -->
    <div
      class="bg-white rounded-2xl shadow-sm p-6 h-fit sticky bottom-0 lg:static"
    >
      <h3 class="text-xl font-semibold mb-6">Order Summary</h3>

      <div class="space-y-4 text-gray-600">
        <div class="flex justify-between">
          <span>Subtotal</span>
          <span>$<%= subtotal %></span>
        </div>

        <div class="flex justify-between">
          <span>Discount</span>
          <span>- $<%= discount %></span>
        </div>

        <div class="flex justify-between">
          <span>Delivery Fee</span>
          <span>$<%= deliveryFee %></span>
        </div>

        <hr />

        <div class="flex justify-between text-lg font-bold text-black">
          <span>Total</span>
          <span>$<%= total %></span>
        </div>
      </div>

      <button
        class="mt-6 w-full bg-black text-white py-3 rounded-xl font-semibold hover:bg-gray-800"
      >
        Proceed to Checkout
      </button>
    </div>
  </div>
  <% } %>
</div>

<%- include('./partials/footer') %>
